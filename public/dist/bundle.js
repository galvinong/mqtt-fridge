"use strict";function addNewCard(t,a,n){var e={title:$("#title-input").val(),location:$("#location-input").val(),returndata:a,unitvalue:$("#unit-input").val(),cardtext:$("#description-input").val(),buttonValue:n};t.cards.push(e)}function addNewSubscribe(t,a){client.subscribe(t);var n={id:t,return:a};channelSubscribe.channel.push(n)}function addNewWarning(t){if(""!==$("#operator-select").val()){var a={id:t,title:$("#title-input").val(),compare:$("#operator-select").val(),warning:$("#warning-input").val()};console.log(a),$.ajax({type:"POST",data:JSON.stringify(a),url:"./add-warn",contentType:"application/json"})}}function round(t,a){return Number(Math.round(t+"e"+a)+"e-"+a)}function onConnect(){console.log("onConnect"),pahoClient.subscribe("RF24SN/in/1/1",{qos:0}),pahoClient.subscribe("RF24SN/in/1/2",{qos:0})}function doFail(t){console.log(t)}function onConnectionLost(t){0!==t.errorCode&&console.log("onConnectionLost: "+t.errorMessage)}function onMessageArrived(t){if("NaN"!==t.payloadString)for(var a=Math.floor(100*t.payloadString)/100,n=0;n<channelSubscribe.channel.length;n++)t.destinationName==channelSubscribe.channel[n].id&&$("#"+channelSubscribe.channel[n].return).html(a)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){var t=Handlebars.template;(Handlebars.templates=Handlebars.templates||{})["card-template"]=t({1:function(t,a,n,e,o){var l,r=null!=a?a:{},i=n.helperMissing,d="function",u=t.escapeExpression;return'    <div class="card text-center col-md-4 col-md-offset-4" id= '+u((l=null!=(l=n.title||(null!=a?a.title:a))?l:i,(void 0===l?"undefined":_typeof(l))===d?l.call(r,{name:"title",hash:{},data:o}):l))+' style="max-width: 275px;">\n        <div class="card-block">\n            <h4 class="card-title">'+u((l=null!=(l=n.title||(null!=a?a.title:a))?l:i,(void 0===l?"undefined":_typeof(l))===d?l.call(r,{name:"title",hash:{},data:o}):l))+'</h4>\n            <h6 class="card-subtitle">Location:\n                              '+u((l=null!=(l=n.location||(null!=a?a.location:a))?l:i,(void 0===l?"undefined":_typeof(l))===d?l.call(r,{name:"location",hash:{},data:o}):l))+'</h6>\n            <h6 class="saving loading card-title text-muted">\n                    Waiting<span>.</span><span>.</span><span>.</span>\n                </h6>\n            <span class="ready-value">\n                <canvas style="min-height:150px;" id="'+u((l=null!=(l=n.canvasID||(null!=a?a.canvasID:a))?l:i,(void 0===l?"undefined":_typeof(l))===d?l.call(r,{name:"canvasID",hash:{},data:o}):l))+'"></canvas>\n                <span class="card-title" id="'+u((l=null!=(l=n.returndata||(null!=a?a.returndata:a))?l:i,(void 0===l?"undefined":_typeof(l))===d?l.call(r,{name:"returndata",hash:{},data:o}):l))+'"></span>\n                <span class="card-title">'+u((l=null!=(l=n.unitvalue||(null!=a?a.unitvalue:a))?l:i,(void 0===l?"undefined":_typeof(l))===d?l.call(r,{name:"unitvalue",hash:{},data:o}):l))+'</span>\n            </span>\n            <p class="card-text">\n                '+u((l=null!=(l=n.cardtext||(null!=a?a.cardtext:a))?l:i,(void 0===l?"undefined":_typeof(l))===d?l.call(r,{name:"cardtext",hash:{},data:o}):l))+'\n            </p>\n            <button type="button" class="btn btn-secondary col-md-12" id="'+u((l=null!=(l=n.buttonValue||(null!=a?a.buttonValue:a))?l:i,(void 0===l?"undefined":_typeof(l))===d?l.call(r,{name:"buttonValue",hash:{},data:o}):l))+'">\n                    <i class="fa fa-trash" aria-hidden="true"></i>\n                </button>\n            <script>\n                $(\'#'+u((l=null!=(l=n.buttonValue||(null!=a?a.buttonValue:a))?l:i,(void 0===l?"undefined":_typeof(l))===d?l.call(r,{name:"buttonValue",hash:{},data:o}):l))+"').click(function() {\n                \t$('#"+u((l=null!=(l=n.title||(null!=a?a.title:a))?l:i,(void 0===l?"undefined":_typeof(l))===d?l.call(r,{name:"title",hash:{},data:o}):l))+"').remove()\n                \tlet newWarning = {\n                \t\ttitle: $('#title-input').val(),\n                \t\tcompare: $('#operator-select').val(),\n                \t\twarning: $('#warning-input').val(),\n                \t}\n                \t$.ajax({\n                \t\ttype: 'DELETE',\n                \t\tdata: JSON.stringify(newWarning),\n                \t\turl: './add-warn',\n                \t\tcontentType: 'application/json',\n                \t})\n                })\n            <\/script>\n        </div>\n    </div>\n"},compiler:[7,">= 4.0.0"],main:function(t,a,n,e,o){var l;return null!=(l=n.each.call(null!=a?a:{},null!=a?a.cards:a,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o}))?l:""},useData:!0})}();var pastHour=moment().subtract(1,"hours"),pastMinute=moment().subtract(1,"minutes"),labels=[],tempData=[],humdData=[];$(".loading").hide(),$.ajax({url:"./get-data/1/"+pastMinute,dataType:"json"}).done(function(t){var a=round(t[0].events.value,2);console.log(a),$("#returntemp").html(a),tempGauge.set(a)}),$.ajax({url:"./get-data/2/"+pastMinute,dataType:"json"}).done(function(t){var a=round(t[0].events.value,2);$("#returnhumd").html(a),humdGauge.set(a)}),$.ajax({url:"./get-data/1/"+pastHour,dataType:"json"}).done(function(t){t.forEach(function(t){labels.push(moment(t.events.created).format("MM-DD hh:mm")),tempData.push(t.events.value)})}),$.ajax({url:"./get-data/2/"+pastHour,dataType:"json"}).done(function(t){t.forEach(function(t){humdData.push(t.events.value)})});var data={labels:labels,datasets:[{label:"Temperature",fill:!1,lineTension:.1,backgroundColor:"rgba(217, 83, 79, 1)",borderColor:"rgba(217, 83, 79, 1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(217, 83, 79, 1)",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(217, 83, 79, 1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:tempData,spanGaps:!0},{label:"Humidity",fill:!1,lineTension:.1,backgroundColor:"rgba(84, 137, 225, 1)",borderColor:"rgba(84, 137, 225, 1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(84, 137, 225, 1)",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(84, 137, 225, 1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:humdData,spanGaps:!0}]};window.onload=function(){var t=document.getElementById("chartID").getContext("2d");window.lineChart=new Chart(t,{type:"line",data:data,options:{title:{display:!0,text:"Live Updates"},responsive:!0,maintainAspectRatio:!1}}),setTimeout(function(){var t=moment().format("MM-DD hh:mm"),a=document.getElementById("returntemp").innerHTML,n=document.getElementById("returnhumd").innerHTML;(isNaN(a)||isNaN(n)||""!==a||""!==n)&&(console.log(a+" "+n),lineChart.data.datasets[0].data[labels.length]=a,lineChart.data.datasets[1].data[labels.length]=n,lineChart.data.labels[labels.length]=t,window.lineChart.update(),tempGauge.set(a),humdGauge.set(n))},1e4)};var cardsData={cards:[{title:"Temperature",location:"Top Shelf",returndata:"returntemp",canvasID:"tempcanvas",unitvalue:"°C",cardtext:"+-0.5°C accuracy",buttonValue:"btnTemperature"},{title:"Humidity",location:"Top Shelf",returndata:"returnhumd",canvasID:"humdcanvas",unitvalue:"%",cardtext:"+-2-5% accuracy",buttonValue:"btnHumidity"}]},template=Handlebars.templates["card-template"](cardsData);$(document).ready(function(){$(".loading").hide(),$("#cancelCard").click(function(){$(".collapse").collapse("toggle")}),$("#addCard").click(function(){if(""===$("#title-input").val())$("#title-input").prop("required",!0),$("#title-input").addClass("form-control-danger");else if(""===$("#channel-input").val())$("#channel-input").prop("required",!0);else{var t={cards:[]},a="return"+$("#title-input").val(),n="btn"+$("title-input").val(),e=$("#channel-input").val();addNewCard(t,a,n),addNewSubscribe(e,a),addNewWarning(e);var o=Handlebars.templates["card-template"](t);$("#card-content").append(o),$(".collapse").collapse("toggle")}})});var pahoClient=new Paho.MQTT.Client("m20.cloudmqtt.com",36673,"web_"+parseInt(100*Math.random(),10));pahoClient.onConnectionlost=onConnectionLost,pahoClient.onMessageArrived=onMessageArrived;var options={timeout:3,useSSL:!0,cleanSession:!0,userName:"***REMOVED***",password:"***REMOVED***",onSuccess:onConnect,onFailure:doFail};pahoClient.connect(options);var channelSubscribe={channel:[{id:"RF24SN/in/1/1",return:"returntemp"},{id:"RF24SN/in/1/2",return:"returnhumd"}]};
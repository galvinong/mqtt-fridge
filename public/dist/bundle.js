"use strict";function addNewCard(t,a,n){var e={title:$("#title-input").val(),location:$("#location-input").val(),returndata:a,unitvalue:$("#unit-input").val(),cardtext:$("#description-input").val(),buttonValue:n};t.cards.push(e)}function addNewSubscribe(t,a){client.subscribe(t);var n={id:t,return:a};channelSubscribe.channel.push(n)}function addNewWarning(t){if(""!==$("#operator-select").val()){var a={id:t,title:$("#title-input").val(),compare:$("#operator-select").val(),warning:$("#warning-input").val()};console.log(a),$.ajax({type:"POST",data:JSON.stringify(a),url:"./add-warn",contentType:"application/json"})}}function round(t,a){return Number(Math.round(t+"e"+a)+"e-"+a)}function onConnect(){console.log("onConnect"),pahoClient.subscribe("RF24SN/in/1/1",{qos:0}),pahoClient.subscribe("RF24SN/in/1/2",{qos:0})}function doFail(t){console.log(t)}function onConnectionLost(t){0!==t.errorCode&&console.log("onConnectionLost: "+t.errorMessage)}function onMessageArrived(t){if("NaN"!==t.payloadString)for(var a=Math.floor(100*t.payloadString)/100,n=0;n<channelSubscribe.channel.length;n++)t.destinationName==channelSubscribe.channel[n].id&&$("#"+channelSubscribe.channel[n].return).html(a)}var pastHour=moment().subtract(1,"hours"),pastMinute=moment().subtract(1,"minutes"),labels=[],tempData=[],humdData=[];$(".loading").hide(),$.ajax({url:"./get-data/1/"+pastMinute,dataType:"json"}).done(function(t){var a=round(t[0].events.value,2);console.log(a),$("#returntemp").html(a)}),$.ajax({url:"./get-data/2/"+pastMinute,dataType:"json"}).done(function(t){var a=round(t[0].events.value,2);$("#returnhumd").html(a)}),$.ajax({url:"./get-data/1/"+pastHour,dataType:"json"}).done(function(t){t.forEach(function(t){labels.push(moment(t.events.created).format("MM-DD hh:mm")),tempData.push(t.events.value)})}),$.ajax({url:"./get-data/2/"+pastHour,dataType:"json"}).done(function(t){t.forEach(function(t){humdData.push(t.events.value)})});var data={labels:labels,datasets:[{label:"Temperature",fill:!1,lineTension:.1,backgroundColor:"rgba(217, 83, 79, 1)",borderColor:"rgba(217, 83, 79, 1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(217, 83, 79, 1)",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(217, 83, 79, 1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:tempData,spanGaps:!0},{label:"Humidity",fill:!1,lineTension:.1,backgroundColor:"rgba(84, 137, 225, 1)",borderColor:"rgba(84, 137, 225, 1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(84, 137, 225, 1)",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(84, 137, 225, 1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:humdData,spanGaps:!0}]};window.onload=function(){var t=document.getElementById("chartID").getContext("2d");window.lineChart=new Chart(t,{type:"line",data:data,options:{title:{display:!0,text:"Live Updates"},responsive:!0,maintainAspectRatio:!1}}),window.lineChart.update(),setInterval(function(){var t=moment().format("MM-DD hh:mm"),a=document.getElementById("returntemp").innerHTML,n=document.getElementById("returnhumd").innerHTML;(isNaN(a)||isNaN(n)||""!==a||""!==n)&&(console.log(a+" "+n),lineChart.data.datasets[0].data[labels.length]=a,lineChart.data.datasets[1].data[labels.length]=n,lineChart.data.labels[labels.length]=t,window.lineChart.update())},1e4)};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){var t=Handlebars.template;(Handlebars.templates=Handlebars.templates||{})["card-template"]=t({1:function(t,a,n,e,o){var r,l=null!=a?a:{},i=n.helperMissing,d="function",u=t.escapeExpression;return'        <div class="card text-center col-md-4 col-md-offset-4" id='+u((r=null!=(r=n.title||(null!=a?a.title:a))?r:i,(void 0===r?"undefined":_typeof(r))===d?r.call(l,{name:"title",hash:{},data:o}):r))+' style="max-width: 275px;">\r\n            <div class="card-block">\r\n                <h4 class="card-title">'+u((r=null!=(r=n.title||(null!=a?a.title:a))?r:i,(void 0===r?"undefined":_typeof(r))===d?r.call(l,{name:"title",hash:{},data:o}):r))+'</h4>\r\n                <h6 class="card-subtitle">Location:\r\n                              '+u((r=null!=(r=n.location||(null!=a?a.location:a))?r:i,(void 0===r?"undefined":_typeof(r))===d?r.call(l,{name:"location",hash:{},data:o}):r))+'</h6>\r\n            </div>\r\n            <div class="card-block">\r\n                <h6 class="saving loading card-title text-muted">\r\n                    Waiting<span>.</span><span>.</span><span>.</span>\r\n                </h6>\n                <span class="ready-value">\n                    <span class="card-title" id="'+u((r=null!=(r=n.returndata||(null!=a?a.returndata:a))?r:i,(void 0===r?"undefined":_typeof(r))===d?r.call(l,{name:"returndata",hash:{},data:o}):r))+'"></span>\n                    <span class="card-title">'+u((r=null!=(r=n.unitvalue||(null!=a?a.unitvalue:a))?r:i,(void 0===r?"undefined":_typeof(r))===d?r.call(l,{name:"unitvalue",hash:{},data:o}):r))+'</span>\n                </span>\r\n            </div>\r\n            <div class="card-block">\r\n                <p class="card-text">\r\n                    '+u((r=null!=(r=n.cardtext||(null!=a?a.cardtext:a))?r:i,(void 0===r?"undefined":_typeof(r))===d?r.call(l,{name:"cardtext",hash:{},data:o}):r))+'\r\n                </p>\r\n                <button type="button" class="btn btn-secondary col-md-12" id="'+u((r=null!=(r=n.buttonValue||(null!=a?a.buttonValue:a))?r:i,(void 0===r?"undefined":_typeof(r))===d?r.call(l,{name:"buttonValue",hash:{},data:o}):r))+'">\r\n                    <i class="fa fa-trash" aria-hidden="true"></i>\r\n                </button>\r\n                <script>\r\n                $(\'#'+u((r=null!=(r=n.buttonValue||(null!=a?a.buttonValue:a))?r:i,(void 0===r?"undefined":_typeof(r))===d?r.call(l,{name:"buttonValue",hash:{},data:o}):r))+"').click(function() {\r\n                    $('#"+u((r=null!=(r=n.title||(null!=a?a.title:a))?r:i,(void 0===r?"undefined":_typeof(r))===d?r.call(l,{name:"title",hash:{},data:o}):r))+"').remove()\r\n                })\r\n                <\/script>\r\n            </div>\r\n        </div>\r\n"},compiler:[7,">= 4.0.0"],main:function(t,a,n,e,o){var r;return"\r\n"+(null!=(r=n.each.call(null!=a?a:{},null!=a?a.cards:a,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o}))?r:"")},useData:!0})}();var cardsData={cards:[{title:"Temperature",location:"Top Shelf",returndata:"returntemp",unitvalue:"°C",cardtext:"DHT22 Sensor, measures temperature air +-0.5°C accuracy",buttonValue:"btnTemperature"},{title:"Humidity",location:"Top Shelf",returndata:"returnhumd",unitvalue:"%",cardtext:"DHT22 Sensor, measures humidity air +-2-5% accuracy",buttonValue:"btnHumidity"}]},template=Handlebars.templates["card-template"](cardsData);$(document).ready(function(){$(".loading").hide(),$("#cancelCard").click(function(){$(".collapse").collapse("toggle")}),$("#addCard").click(function(){if(""===$("#title-input").val())$("#title-input").prop("required",!0),$("#title-input").addClass("form-control-danger");else if(""===$("#channel-input").val())$("#channel-input").prop("required",!0);else{var t={cards:[]},a="return"+$("#title-input").val(),n="btn"+$("title-input").val(),e=$("#channel-input").val();addNewCard(t,a,n),addNewSubscribe(e,a),addNewWarning(e);var o=Handlebars.templates["card-template"](t);$("#card-content").append(o),$(".collapse").collapse("toggle")}})});var pahoClient=new Paho.MQTT.Client("m20.cloudmqtt.com",36673,"web_"+parseInt(100*Math.random(),10));pahoClient.onConnectionlost=onConnectionLost,pahoClient.onMessageArrived=onMessageArrived;var options={timeout:3,useSSL:!0,cleanSession:!0,userName:"***REMOVED***",password:"***REMOVED***",onSuccess:onConnect,onFailure:doFail};pahoClient.connect(options);var channelSubscribe={channel:[{id:"RF24SN/in/1/1",return:"returntemp"},{id:"RF24SN/in/1/2",return:"returnhumd"}]};